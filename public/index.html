<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GAME.IT</title>
  <link rel="icon" href="/assets/favicon.svg">
  <link rel="stylesheet" href="/css/styles.css">
  <script>
    function wllogout() {
      fetch('/api/whitelist/logout', {
        method: 'POST',
        credentials: 'include'
      })
      .then(r => r.json())
      .then(data => {
        if (data.ok) {
          window.location.reload();
        } else {
          alert('whitelist logout fail: ' + (data.error || 'unknown'));
        }
      })
      .catch(err => {
        console.error('logout err:', err);
        alert('logout JS error');
      });
    }
  </script>

</head>
<body>

<!-- loading screen -->
<div id="loadingScreen" class="loading-screen" hidden>
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p>Loading games…</p>
  </div>
</div>

<!-- topbar -->
<header class="topbar">
  <div class="topbar__left">
    <button class="hamburger" id="menuBtn" aria-label="Menu" aria-expanded="false"><span></span></button>
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="12" r="10" fill="currentColor" opacity="0.9"></circle>
        <circle cx="12" cy="12" r="4" fill="black" opacity="0.7"></circle>
      </svg>
      <span class="brand__text">GAME.IT</span>
    </div>

    <nav class="nav">
      <button class="nav__link active" data-route="store" onclick="window.location='/';">Underground</button>
      <button class="nav__link" data-route="library" onclick="window.location='/library';">Library</button>
      <button class="nav__link" data-route="community" onclick="window.location='/community';">Community</button>
      <button class="nav__link trusted" data-route="trusted" onclick="window.location='/trusted';">Trusted ❤️</button>
      <button class="nav__link" data-route="community" onclick="wllogout()">WL Logout</button>
    </nav>
  </div>

  <div class="topbar__right">
    <div class="search">
      <input id="searchInput" type="search" placeholder="Search games…">
    </div>
  <!-- mount point for auth UI (JS will inject everything here) --> 
  <div id="auth-root"></div>
</header>

<!-- layout -->
<div class="layout">

  <aside class="sidebar">
    <div class="sidebar__section">
      <div class="sidebar__title">Navigation</div>
      <a class="sidebar__item active" href="/">Games</a>
      <a class="sidebar__item" href="https://massgrave.dev/" target="_blank" rel="noopener noreferrer">Windows / Office Massgrave</a>
    </div>
  </aside>
  <div class="sidebar-scrim" id="sidebarScrim" hidden></div>

  <main class="content">
    <section class="hero">
      <div class="hero__bg"></div>
      <div class="hero__content">
        <h1>This is the future of GAMING: GameIt!</h1>
        <p>Find a game of any genre from the browser of supported sites. But beware – at your <u>own risk</u>!</p>
        <!--
        <div class="hero__actions">
          <button class="btn btn--primary">Add to cart</button>
          <button class="btn btn--ghost">Add to wishlist</button>
        </div>-->
      </div>
    </section>

    <section class="shelf">
      <div class="shelf__header">
        <h2>Recommended for you:</h2>
        <div id="srcFilter" class="src-filter">
          <button data-src="ALL">ALL</button>
          <button data-src="Anker">Anker</button>
          <button data-src="RepackGames">Repack</button>
          <button data-src="OnlineFix">OnlineFix</button>
          <button data-src="Game3RB">Game3RB</button>
          <button data-src="SteamUnderground">SteamUnd.</button>
        </div>
        <div class="sort-controls" style="margin: 15px 0; display: flex; align-items: center; gap: 10px;">
          <label style="color: #fff;">Sort by:</label>
          <select id="sortSelect" style="padding: 8px; background: #1a1d29; color: #fff; border: 1px solid #2a2d3a; border-radius: 4px;">
              <option value="default">Default</option>
              <option value="name-asc">Name (A-Z)</option>
              <option value="name-desc">Name (Z-A)</option>
              <option value="source-asc">Source (A-Z)</option>
              <option value="source-desc">Source (Z-A)</option>
          </select>
        </div>
        <!--<a class="shelf__more" href="#">View all</a>-->
      </div>
      <div class="cards" id="cardGrid"></div>
    </section>
  </main>


</div>

<!-- game modal -->
<div id="gameModal" class="modal" hidden>
  <div class="modal__dialog">
    <button id="modalClose" class="modal__close" aria-label="Close">×</button>
    <div id="modalBody" class="modal__body"></div>
  </div>
</div>



<script src="/js/app.js"></script>
<script src="/js/auth.js"></script>

<script>
// Sidebar drawer toggle (hamburger + scrim + ESC)
(function(){
  const body = document.body;
  const btn = document.getElementById('menuBtn');
  const scrim = document.getElementById('sidebarScrim');
  const sidebar = document.querySelector('.sidebar');
  if (!btn || !scrim || !sidebar) return;

  const open = () => {
    body.classList.add('sidebar-open');
    scrim.hidden = false;
    btn.setAttribute('aria-expanded', 'true');
  };
  const close = () => {
    body.classList.remove('sidebar-open');
    scrim.hidden = true;
    btn.setAttribute('aria-expanded', 'false');
  };

  btn.addEventListener('click', () =>
    body.classList.contains('sidebar-open') ? close() : open()
  );
  scrim.addEventListener('click', close);
  document.addEventListener('keydown', e => { if (e.key === 'Escape') close(); });
})();
</script>


</body>
</html>
