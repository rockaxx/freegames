<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GAME.IT</title>
    <link rel="icon" href="/assets/favicon.svg" />
    <link rel="stylesheet" href="/css/styles.css" />
    <script>
      // Whitelist logout (shared across all pages)
      function wllogout() {
        fetch("/api/whitelist/logout", {
          method: "POST",
          credentials: "include",
        })
          .then((r) => r.json())
          .then((data) =>
            data.ok
              ? window.location.reload()
              : alert("whitelist logout fail: " + (data.error || "unknown"))
          )
          .catch((err) => {
            console.error("logout err:", err);
            alert("logout JS error");
          });
      }
    </script>
  </head>
  <body class="no-sidebar-desktop">
    <!-- topbar -->
    <header class="topbar">
      <div class="topbar__left">
        <div class="brand">
          <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true">
            <circle
              cx="12"
              cy="12"
              r="10"
              fill="currentColor"
              opacity="0.9"
            ></circle>
            <circle cx="12" cy="12" r="4" fill="black" opacity="0.7"></circle>
          </svg>
          <span class="brand__text">GAME.IT</span>
        </div>

        <!-- Mobile burger -->
        <button id="mobileMenuBtn" class="burger" aria-label="Open menu">
          <span></span><span></span><span></span>
        </button>

        <nav class="nav">
          <button
            class="nav__link active"
            data-route="store"
            onclick="window.location='/'"
          >
            Underground
          </button>
          <button
            class="nav__link"
            data-route="library"
            onclick="window.location='/library'"
          >
            Library
          </button>
          <button
            class="nav__link"
            data-route="community"
            onclick="window.location='/community'"
          >
            Community
          </button>
          <button
            class="nav__link trusted"
            data-route="trusted"
            onclick="window.location='/trusted'"
          >
            Trusted ‚ù§Ô∏è
          </button>
          <button class="nav__link" data-route="community" onclick="wllogout()">
            WL Logout
          </button>
        </nav>
      </div>

      <div class="topbar__right">
        <!-- mount point for auth UI (JS will inject everything here) -->
        <div id="auth-root"></div>
      </div>
    </header>

    <!-- Backdrop for mobile drawer -->
    <div id="sidebarBackdrop" class="sidebar-backdrop" hidden></div>

    <!-- layout -->
    <div class="layout">
      <aside class="sidebar" id="mobileDrawer">
        <nav class="mnav" aria-label="Main">
          <div class="mnav__section">
            <div class="mnav__title">Menu</div>
            <a class="mnav__item" href="/">Games üéÆ</a>
            <a class="mnav__item" active href="/library">Library ‚≠ê</a>
            <a class="mnav__item" href="/community">Community üó£Ô∏è</a>
            <a class="mnav__item" href="/trusted">Trusted ‚ù§Ô∏è</a>
            <button id="mnav-logout" class="mnav__item mnav__btn" type="button">
              Whitelist logout
            </button>
          </div>
        </nav>
      </aside>

      <main class="content">
        <section class="shelf">
          <div class="shelf__header">
            <h2>Your favourites ‚≠ê</h2>
          </div>
          <div class="cards" id="cardGrid"></div>
        </section>
      </main>
    </div>

    <!-- game modal -->
    <div id="gameModal" class="modal" hidden>
      <div class="modal__dialog">
        <button id="modalClose" class="modal__close" aria-label="Close">
          √ó
        </button>
        <div id="modalBody" class="modal__body"></div>
      </div>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/library.js"></script>
    <script src="/js/mobile_menu.js"></script>
  </body>
</html>
